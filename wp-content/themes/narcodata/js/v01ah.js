var visualizacion=function(){function t(){E.attr("transform","translate("+N+",0)");var t=queue(1);t.defer(window.d3.tsv,"tsv/presidentes.tsv",function(t){return{id:t.id,nombre:t.nombre,inicio:+t.inicio,fotografia:"img/"+t.fotografia,nombrecorto:t.nombrecorto}}),t.defer(window.d3.tsv,"tsv/carteles.tsv",function(t){return{id:t.id,nombre:t.nombre,nombrelargo:t.nombrelargo,fila:+t.fila,mitad:"1"===t.mitad?!0:!1,fondo:t.fondo,color:t.color,borde:t.borde,inicio:+t.inicio,fin:+t.fin,porcentaje:+t.porcentaje,pleca:"1"===t.pleca?!0:!1,lineaini:t.lineaini,lineafin:t.lineafin,inicial:t.inicial,lideres:t.lideres.split("|"),x:0,y:0,w:0,h:0,yi:0,yf:0}}),t.defer(window.d3.tsv,"tsv/origenes.tsv",function(t){return{origen:t.origen,destino:t.destino,offset:+t.offset}}),t.defer(window.d3.tsv,"tsv/federaciones.tsv",function(t){return{id:t.id,nombre:t.nombre,lideres:t.lideres.split("|"),inicio:+t.inicio,fin:+t.fin,color:t.color,fuente:t.fuente,w:0,y:0,x:0}}),t.defer(window.d3.tsv,"tsv/federacionescarteles.tsv",function(t){return{id:t.id,aliados:t.aliados.split("|"),involucrados:t.involucrados.split("|"),x:0,y:500}}),t.defer(window.d3.tsv,"tsv/celulas.tsv"),t.awaitAll(e)}function e(t,e){$=e[0],L=e[1],T=e[2],B=e[3],C=e[4],F=e[5];var r=window._.indexBy(L,"fila"),a=window._.pluck(r,"fila"),l=(v+g)*a.length+m,o=x*$.length;G.append("rect").attr("fill","#cdcdcd").attr("x",0).attr("y",0).attr("width",N).attr("height",m),G.append("rect").attr("fill","#58595b").attr("x",0).attr("y",m).attr("width",N).attr("height",l);var f=E.append("rect").attr("class","telon").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").style("fill","#ffffff");n(),generaFederaciones(),i(),c(),s(),w(),ajustaCarteles(),p(),generaTooltips(),S.attr("preserveAspectRatio","xMidYMid"),S.attr("viewBox","0 0 "+(o+N)+" "+j),G.append("text").attr("transform","rotate(270 "+(N/2+6)+","+(j/2+m)+")").attr("x",N/2+6).attr("y",j/2+m).style("stroke","#ffffff").style("fill","#ffffff").style("text-transform","uppercase").style("font-size",18).style("font-family",'"Helvetica Neue",Helvetica,Arial,sans-serif').style("letter-spacing",5).html("Cárteles"),Y.selectAll("line, path, text").style("opacity",0),X.selectAll("rect, text").style("opacity",0),f.transition().duration(1e3).attr("x",o).each("end",function(){Y.selectAll("line, path, text").transition().duration(500).style("opacity",1),X.selectAll("rect, text").transition().duration(500).style("opacity",1)}).remove()}function n(){P.selectAll("rect").data($).enter().append("rect").attr("x",function(t,e){return e*x}).attr("y",0).attr("width",x).attr("height",m).attr("fill","#000000").style("stroke","#ffffff").style("stroke-width",2),P.selectAll("text.periodo").data($).enter().append("text").attr("class","periodo").attr("x",function(t,e){return r(e)}).attr("y",k).style("font-size","24px").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text(function(t){var e=t.inicio+" - "+(t.inicio+6);return"EPN"==t.id&&(e=t.inicio+" a 2014"),e}),P.selectAll("text.presidente").data($).enter().append("text").attr("class","presidente").attr("x",function(t,e){return r(e)}).attr("y",b).style("font-size","12px").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text(function(t){return t.nombre}),P.selectAll(".fotografia.presidente").data($).enter().append("svg:image").attr("width",q).attr("height",q).attr("class","presidente fotografia").attr("xlink:href",function(t){return t.fotografia}).attr("x",function(t,e){return(e+1)*x-(q+M)}).attr("y",function(t){return(m-q)/2})}function r(t){var e=t*x+M,n=x-(q+2*M);return n/2+e}function i(){var t=$.length+1,e=0,n=(v+g)*L.length,r=1;for(r=1;t>=r;r++)D.append("line").style("stroke","#000000").style("stroke-width",1).style("opacity",1).attr("x1",e).attr("y1",m).attr("x2",e).attr("y2",m+n).style("stroke-dasharray","1,3"),e=r*x}function a(){var t=window._.min($,function(t){return t.inicio});return t.inicio}function l(t){return Math.ceil(v*t/100)}function o(t){return Math.ceil((v-t)/2)}function c(){var t=a(),e=0,n=0,r=0,i=0,c=0,s=0,f=0,d=0;window._.each(L,function(a){n=m+(v+g)*a.fila-v,a.mitad&&(n+=v/2),d=l(a.porcentaje),f=n+o(d),s=f+d,i=(a.inicio-t)*h,c=(a.fin-t)*h,e=i,r=c-i,a.x=e,a.y=n,a.w=r,a.h=d,a.yf=s,a.yi=f}),W.selectAll("rect.cartel").data(L).enter().append("rect").attr("class",function(t){return"cartel "+t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.yi}).attr("width",function(t){return t.w}).attr("height",function(t){return t.h}).attr("fill",function(t){return t.fondo}).attr("stroke",function(t){return t.fondo}).attr("stroke-width",1)}function s(){var t=(2*y(A),window._.select(L,function(t){return""!==t.nombre}));Y.selectAll("text.cartel").data(t).enter().append("text").attr("class","cartel").attr("class",function(t){return"cartel "+t.id}).attr("fill","#ffffff").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",12).attr("text-anchor","middle").attr("x",function(t){return t.x+Math.ceil(t.w/2)}).attr("y",function(t){return t.y+30}).text(function(t){return t.nombre}),Y.selectAll("text.cartel").call(f),Y.selectAll("text.wrapped").call(d)}function f(t){t.each(function(){for(var t,e=window.d3.select(this),n=e.text().split(/\s+/).reverse(),r=e.attr("class"),i=[],a=0,l=1.2,o=e.attr("y"),c=parseFloat(e.attr("dy")||0),s=e.attr("class","wrapped "+r).text(null).append("tspan").attr("class",r).attr("x",e.attr("x")).attr("y",o).attr("dy",c+"em");t=n.pop();)i.push(t),s.text(i.join(" ")),s.node().getComputedTextLength()>e.datum().w-30&&(i.pop(),s.text(i.join(" ")),i=[t],s=e.append("tspan").attr("class",r).attr("x",e.attr("x")).attr("y",o).attr("dy",++a*l+c+"em").text(t))})}function d(t){window._.each(t[0],function(t){t=window.d3.select(t);var e=t.selectAll("tspan"),n=e[0].length,r=n%2===0?!0:!1,i=Math.floor(n/2),a=1.2,l=a;r?(l=a/2,i--,i*=a,i+=l,i*=-1):(i*=l,i*=-1),e.each(function(){var t=window.d3.select(this);t.attr("dy",parseFloat(t.attr("dy").replace("em",""))+i+"em")})})}function u(t){var e=window._.select(L,function(e){return""!==e[t]}),n=window._.pluck(e,t);return n=window._.uniq(n)}function p(){var t=u("lineaini"),e=[],n=0,r=0,i=0,a={},l=[];window._.each(t,function(t){e=window._.select(L,{lineaini:t}),a=window._.min(e,"x"),n=a.x,a=window._.min(e,"yi"),r=a.yi,a=window._.max(e,"yf"),i=a.yf,l.push({x1:n,x2:n,y1:r,y2:i})}),t=u("lineafin"),window._.each(t,function(t){e=window._.select(L,{lineafin:t}),a=window._.min(e,"x"),n=a.x+a.w,a=window._.min(e,"yi"),r=a.yi,a=window._.max(e,"yf"),i=a.yf,l.push({x1:n,x2:n,y1:r,y2:i})}),Y.selectAll("line.pleca").data(l).enter().append("line").attr("class","pleca").style("stroke","#000000").style("stroke-width",_).style("opacity",1).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2});var o=window.d3.svg.symbol().type("triangle-up").size(A),c=y(A),s=v/2,f=window._.select(L,{pleca:!0});Y.selectAll("path.pleca").data(f).enter().append("path").attr("d",o).attr("class","pleca").attr("transform",function(t){return"translate("+(t.x+c)+","+(t.y+s)+"), rotate(90)"});var d=[],p=[],w=c,h=null,x=null,m=[];window._.each(T,function(t){m=window._.select(L,{id:t.destino}),x=window._.min(m,"inicio"),h=window._.find(L,function(e){return e.id===t.origen&&e.inicio<=x.inicio&&x.inicio<=e.fin}),d.push({x1:x.x-10,x2:x.x+_/2,y1:h.yi+h.h/2+t.offset,y2:h.yi+h.h/2+t.offset}),x.yi>=h.yi?(d.push({x1:x.x,x2:x.x,y1:h.yi+h.h/2+t.offset,y2:x.yi-w}),p.push({x:x.x,y:x.yi,o:-w,rot:180})):(d.push({x1:x.x,x2:x.x,y1:h.yi+h.h/2+t.offset,y2:x.yf+w}),p.push({x:x.x,y:x.yf,o:w,rot:0}))}),Y.selectAll("line.flecha").data(d).enter().append("line").attr("class","flecha").style("stroke","#000000").style("stroke-width",_).style("opacity",1).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2}),Y.selectAll("path.flecha").data(p).enter().append("path").attr("d",o).attr("class","flecha").attr("transform",function(t){return"translate("+t.x+","+(t.y+t.o)+"), rotate("+t.rot+")"})}function y(t){var e=Math.sqrt(3)/2,n=Math.sqrt(e*t*2);return Math.floor(n/2)-2}function w(){var t=null,e=[],n=window.d3.selectAll("text.wrapped");n.each(function(n){t=this.getBBox(),e.push({color:n.color,borde:n.borde,x:t.x-H,y:t.y-z,width:t.width+2*H,height:t.height+2*z,clase:n.id})}),X.selectAll("rect.etiqueta").data(e).enter().append("rect").attr("class",function(t){return"etiqueta "+t.clase}).style("fill",function(t){return t.color}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("stroke",function(t){return t.borde}).attr("stroke-width",2)}var h=40,x=6*h,v=50,m=70,g=4,A=200,_=5,b=53,k=35,H=2,z=2,j=0,q=50,M=10,N=40,$=[],L=[],T=[],B=[],C=[],F=[],R=window.d3.select("#contenedor01ah"),S=R.append("svg").attr("id","svg"),V=S.append("g").attr("transform","translate("+N+",0)"),W=S.append("g").attr("transform","translate("+N+",0)"),X=S.append("g").attr("transform","translate("+N+",0)"),Y=S.append("g").attr("transform","translate("+N+",0)"),E=S.append("g"),P=S.append("g").attr("transform","translate("+N+",0)"),D=S.append("g").attr("transform","translate("+N+",0)"),G=(S.append("g").attr("transform","translate("+N+",0)"),S.append("g"));return ajustaCarteles=function(){var t=m+g,e=0,n=window._.pluck(L,"fila");n=window._.uniq(n),n.sort(function(t,e){return t-e}),window._.each(n,function(n){var r=0,i=0,a=0,l=window._.select(L,{fila:n}),o=window._.pluck(l,"id");o=window._.uniq(o),window._.each(o,function(e){var n=W.selectAll("rect.cartel."+e);n.each(function(t){t.h>r&&(r=t.h,i=t.yi)});var l=X.selectAll("rect."+e);l.each(function(t){t.height>r&&(r=t.height,i=t.y)}),a=i-t,n.each(function(t){t.y=t.y-a,t.yi=t.yi-a,t.yf=t.yf-a}),Y.selectAll("tspan."+e).each(function(){var t=window.d3.select(this);t.attr("y",t.attr("y")-a)}),X.selectAll("rect."+e).each(function(t){t.y=t.y-a})}),n!==e&&(t+=r+g)}),W.selectAll("rect.cartel").attr("y",function(t){return t.yi}),Y.selectAll("text.cartel").attr("y",function(t){return t.y+30}),X.selectAll("rect").attr("y",function(t){return t.y});var r=W.selectAll("rect.cartel");r.each(function(t){t.h+t.yi>j&&(j=t.h+t.yi)});var i=X.selectAll("rect");i.each(function(t){t.height+t.y>j&&(j=t.height+t.y)}),j+=g},generaTooltips=function(){var t=x*$.length,e=window.$(R.node()).width();W.selectAll("rect.cartel").each(function(n,r){var i=n.lideres.length<2?"Líder":"Líderes",a="";window._.each(n.lideres,function(t){a+="<li>"+t+"</li>"});var l=n.inicio,o=n.w/2/(t/e),c=window._.findLast($,function(t){var e=t.inicio+6;return t.inicio<=l&&e>=l}),s='<p class="tt-titulo">'+n.nombrelargo+'</p><p class="tt-subtitulo">'+i+" en el sexenio de "+c.nombrecorto+':</p><ul class="tt-lideres">'+a+"</ul>";window.$(this).tooltipster({theme:"tooltipster tooltipster-"+n.id,content:window.$(s),position:"top",offsetX:o,maxWidth:x-30,functionReady:ajustaTooltip})}),V.selectAll("rect.federacion").each(function(n,r){var i=n.lideres.length<2?"Líder":"Líderes",a="";window._.each(n.lideres,function(t){a+="<li>"+t+"</li>"});var l=n.w/2/(t/e),o='<p class="tt-titulo">'+n.nombre+'</p><p class="tt-subtitulo">'+i+':</p><ul class="tt-lideres">'+a+"</ul>";window.$(this).tooltipster({theme:"tooltipster tooltipster-"+n.id,content:window.$(o),position:"top",offsetX:l,offsetY:3*-j/4/(t/e),maxWidth:x-30,functionReady:ajustaTooltip})})},ajustaTooltip=function(t,e){var n=window.$(e[0]).find("div").html();window.$(t).tooltipster("content",window.$(n))},generaFederaciones=function(){var t=a(),e=(v+g)*L.length,n=[],r=[];V.selectAll("rect.federacion").data(B).enter().append("rect").attr("class",function(t){return"federacion "+t.id}).attr("x",function(e){var r=(e.inicio-t)*h;return n.push(r),r}).attr("y",m).attr("width",function(t){return t.w=(t.fin-t.inicio)*h,t.w}).attr("height",e).style("fill",function(t){return t.color}),X.selectAll("text.federacion.titulo").data(C).enter().append("text").attr("class","federacion titulo").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",16).style("font-weight","bold").style("text-transform","uppercase").attr("fill",function(t){var e=window._.find(B,{id:t.id});return e.fuente}).attr("x",function(e){var n=window._.find(B,{id:e.id}),r=n.inicio-t,i=n.fin-n.inicio,a=(r+i/2)*h;return e.x=a,a}).attr("y",function(t){return t.y}).text(function(t){var e=window._.find(B,{id:t.id});return e.nombre}),X.selectAll("text.federacion.fechas").data(C).enter().append("text").attr("class","federacion fechas").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",14).attr("fill","#000000").attr("x",function(t){return t.x}).attr("y",function(t){var e=t.y+20;return r.push(t.y+20),e}).text(function(t){var e=window._.find(B,{id:t.id});return e.inicio+" - "+e.fin});var i=window.d3.svg.symbol().type("cross").size(80);V.append("circle").attr("cx",n[0]+62).attr("cy",r[0]+20).attr("r",12).style("fill","#e1a632"),V.append("circle").attr("cx",n[0]+84).attr("cy",r[0]+20).attr("r",12).style("fill","#8fc64f"),X.append("path").attr("d",i).attr("transform",function(t){return"translate("+(n[0]+74)+","+(r[0]+20)+")"}),V.append("circle").attr("cx",n[0]+138).attr("cy",r[0]+20).attr("r",12).style("fill","#54c8f2"),X.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",10).style("font-style","italic").attr("fill","#000000").attr("x",n[0]+112).attr("y",r[0]+25).text("VS."),V.append("circle").attr("cx",n[1]+14).attr("cy",r[1]+20).attr("r",12).style("fill","#e1a632"),V.append("circle").attr("cx",n[1]+38).attr("cy",r[1]+20).attr("r",12).style("fill","#8fc64f"),X.append("path").attr("d",i).attr("transform",function(t){return"translate("+(n[1]+26)+","+(r[1]+20)+")"}),V.append("circle").attr("cx",n[1]+80).attr("cy",r[1]+20).attr("r",12).style("fill","#54c8f2"),V.append("circle").attr("cx",n[1]+105).attr("cy",r[1]+20).attr("r",12).style("fill","#b09bc7"),X.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",10).style("font-style","italic").attr("fill","#000000").attr("x",n[1]+60).attr("y",r[1]+25).text("VS.")},{init:t}}();