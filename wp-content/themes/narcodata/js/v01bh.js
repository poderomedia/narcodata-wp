var visualizacion_h=function(){function t(){var t=queue(1);t.defer(window.d3.tsv,"tsv/presidentes.tsv",function(t){return{id:t.id,nombre:t.nombre,inicio:+t.inicio,fotografia:"img/"+t.fotografia,nombrecorto:t.nombrecorto}}),t.defer(window.d3.tsv,"tsv/carteles.tsv",function(t){return{id:t.id,nombre:t.nombre,nombree:t.nombree,nombrelargo:t.nombrelargo,fila:+t.fila,mitad:"1"===t.mitad?!0:!1,fondo:t.fondo,color:t.color,borde:t.borde,anillo:t.anillo,inicio:+t.inicio,fin:+t.fin,porcentaje:+t.porcentaje,pleca:"1"===t.pleca?!0:!1,lineaini:t.lineaini,lineafin:t.lineafin,inicial:t.inicial,inicialc:t.inicialc,lideres:t.lideres.split("|"),x:0,y:0,w:0,h:0,yi:0,yf:0}}),t.defer(window.d3.tsv,"tsv/origenes.tsv",function(t){return{origen:t.origen,destino:t.destino,offset:+t.offset}}),t.defer(window.d3.tsv,"tsv/federaciones.tsv",function(t){return{id:t.id,nombre:t.nombre,lideres:t.lideres.split("|"),inicio:+t.inicio,fin:+t.fin,color:t.color,fuente:t.fuente,w:0,y:0,x:0}}),t.defer(window.d3.tsv,"tsv/federacionescarteles.tsv",function(t){return{id:t.id,aliados:t.aliados.split("|"),involucrados:t.involucrados.split("|"),x:0,y:500}}),t.defer(window.d3.tsv,"tsv/celulas.tsv"),t.awaitAll(e)}function e(t,e){T=e[0],O=e[1],B=e[2],G=e[3],F=e[4],S=e[5];var r=window._.indexBy(O,"fila"),a=window._.pluck(r,"fila"),l=(g+A)*a.length+m,o=v*T.length;J.append("rect").attr("fill","#cdcdcd").attr("x",0).attr("y",0).attr("width",C).attr("height",m),J.append("rect").attr("fill","#58595b").attr("x",0).attr("y",m).attr("width",C).attr("height",l);P.append("rect").attr("class","telon").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").style("fill","#000000").style("opacity",.7);n(),generaFederaciones(),i(),c(),s(),x(),ajustaCarteles(),y(),generaCelulas(),generaGrafos(),w(),V.attr("preserveAspectRatio","xMidYMid"),V.attr("viewBox","0 0 "+(o+C)+" "+N),J.append("text").attr("transform","rotate(270 "+(C/2+6)+","+(N/2+m)+")").attr("x",C/2+6).attr("y",N/2+m).style("stroke","#ffffff").style("fill","#ffffff").style("text-transform","uppercase").style("font-size",18).style("font-family",'"Helvetica Neue",Helvetica,Arial,sans-serif').style("letter-spacing",5).html("Cárteles")}function n(){W.selectAll("rect.presidente").data(T).enter().append("rect").attr("x",function(t,e){return e*v}).attr("y",0).attr("class","presidente").attr("width",v).attr("height",m).attr("fill","#000000").style("stroke","#ffffff").style("stroke-width",2),W.selectAll("text.periodo").data(T).enter().append("text").attr("class","periodo ignorar").attr("x",function(t,e){return r(e)}).attr("y",H).style("font-size","24px").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text(function(t){var e=t.inicio+" - "+(t.inicio+6);return"EPN"==t.id&&(e=t.inicio+" a 2014"),e}),W.selectAll("text.presidente").data(T).enter().append("text").attr("class","presidente ignorar").attr("x",function(t,e){return r(e)}).attr("y",k).style("font-size","12px").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text(function(t){return t.nombre}),W.selectAll(".fotografia.presidente").data(T).enter().append("svg:image").attr("width",j).attr("height",j).attr("class","presidente fotografia ignorar").attr("xlink:href",function(t){return t.fotografia}).attr("x",function(t,e){return(e+1)*v-(j+M)}).attr("y",function(t){return(m-j)/2})}function r(t){var e=t*v+M,n=v-(j+2*M);return n/2+e}function i(){var t=T.length+1,e=0,n=(g+A)*O.length,r=1;for(r=1;t>=r;r++)X.append("line").style("stroke","#ffffff").style("stroke-width",2).style("opacity",1).attr("x1",e).attr("y1",m).attr("x2",e).attr("y2",m+n),e=r*v}function a(){var t=window._.min(T,function(t){return t.inicio});return t.inicio}function l(t){return Math.ceil(g*t/100)}function o(t){return Math.ceil((g-t)/2)}function c(){var t=a(),e=0,n=0,r=0,i=0,c=0,s=0,f=0,d=0;window._.each(O,function(a){n=m+(g+A)*a.fila-g,a.mitad&&(n+=g/2),d=l(a.porcentaje),f=n+o(d),s=f+d,i=(a.inicio-t)*h,c=(a.fin-t)*h,e=i,r=c-i,a.x=e,a.y=n,a.w=r,a.h=d,a.yf=s,a.yi=f}),D.selectAll("rect.cartel").data(O).enter().append("rect").attr("class",function(t){return"cartel "+t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.yi}).attr("width",function(t){return t.w}).attr("height",function(t){return t.h}).attr("fill",function(t){return t.fondo}).attr("stroke",function(t){return t.fondo}).attr("stroke-width",1)}function s(){var t=(2*p(_),window._.select(O,function(t){return""!==t.nombre}));L.selectAll("text.cartel").data(t).enter().append("text").attr("class","cartel").attr("class",function(t){return"cartel "+t.id}).attr("fill","#ffffff").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",12).attr("text-anchor","middle").attr("x",function(t){return t.x+Math.ceil(t.w/2)}).attr("y",function(t){return t.y+30}).text(function(t){return t.nombre}),L.selectAll("text.cartel").call(f),L.selectAll("text.wrapped").call(d)}function f(t){t.each(function(){for(var t,e=window.d3.select(this),n=e.text().split(/\s+/).reverse(),r=e.attr("class"),i=[],a=0,l=1.2,o=e.attr("y"),c=parseFloat(e.attr("dy")||0),s=e.attr("class","wrapped "+r).text(null).append("tspan").attr("class",r).attr("x",e.attr("x")).attr("y",o).attr("dy",c+"em");t=n.pop();)i.push(t),s.text(i.join(" ")),s.node().getComputedTextLength()>e.datum().w-30&&(i.pop(),s.text(i.join(" ")),i=[t],s=e.append("tspan").attr("class",r).attr("x",e.attr("x")).attr("y",o).attr("dy",++a*l+c+"em").text(t))})}function d(t){window._.each(t[0],function(t){t=window.d3.select(t);var e=t.selectAll("tspan"),n=e[0].length,r=n%2===0?!0:!1,i=Math.floor(n/2),a=1.2,l=a;r?(l=a/2,i--,i*=a,i+=l,i*=-1):(i*=l,i*=-1),e.each(function(){var t=window.d3.select(this);t.attr("dy",parseFloat(t.attr("dy").replace("em",""))+i+"em")})})}function u(t){var e=window._.select(O,function(e){return""!==e[t]}),n=window._.pluck(e,t);return n=window._.uniq(n)}function y(){var t=u("lineaini"),e=[],n=0,r=0,i=0,a={},l=[];window._.each(t,function(t){e=window._.select(O,{lineaini:t}),a=window._.min(e,"x"),n=a.x,a=window._.min(e,"yi"),r=a.yi,a=window._.max(e,"yf"),i=a.yf,l.push({x1:n,x2:n,y1:r,y2:i})}),t=u("lineafin"),window._.each(t,function(t){e=window._.select(O,{lineafin:t}),a=window._.min(e,"x"),n=a.x+a.w,a=window._.min(e,"yi"),r=a.yi,a=window._.max(e,"yf"),i=a.yf,l.push({x1:n,x2:n,y1:r,y2:i})}),L.selectAll("line.pleca").data(l).enter().append("line").attr("class","pleca").style("stroke","#000000").style("stroke-width",b).style("opacity",1).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2});var o=window.d3.svg.symbol().type("triangle-up").size(_),c=p(_),s=g/2,f=window._.select(O,{pleca:!0});L.selectAll("path.pleca").data(f).enter().append("path").attr("d",o).attr("class","pleca").attr("transform",function(t){return"translate("+(t.x+c)+","+(t.y+s)+"), rotate(90)"});var d=[],y=[],x=c,w=null,h=null,v=[];window._.each(B,function(t){v=window._.select(O,{id:t.destino}),h=window._.min(v,"inicio"),w=window._.find(O,function(e){return e.id===t.origen&&e.inicio<=h.inicio&&h.inicio<=e.fin}),d.push({x1:h.x-10,x2:h.x+b/2,y1:w.yi+w.h/2+t.offset,y2:w.yi+w.h/2+t.offset}),h.yi>=w.yi?(d.push({x1:h.x,x2:h.x,y1:w.yi+w.h/2+t.offset,y2:h.yi-x}),y.push({x:h.x,y:h.yi,o:-x,rot:180})):(d.push({x1:h.x,x2:h.x,y1:w.yi+w.h/2+t.offset,y2:h.yf+x}),y.push({x:h.x,y:h.yf,o:x,rot:0}))}),L.selectAll("line.flecha").data(d).enter().append("line").attr("class","flecha").style("stroke","#000000").style("stroke-width",b).style("opacity",1).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2}),L.selectAll("path.flecha").data(y).enter().append("path").attr("d",o).attr("class","flecha").attr("transform",function(t){return"translate("+t.x+","+(t.y+t.o)+"), rotate("+t.rot+")"})}function p(t){var e=Math.sqrt(3)/2,n=Math.sqrt(e*t*2);return Math.floor(n/2)-2}function x(){var t=null,e=[],n=window.d3.selectAll("text.wrapped");n.each(function(n){t=this.getBBox(),e.push({color:n.color,borde:n.borde,x:t.x-z,y:t.y-q,width:t.width+2*z,height:t.height+2*q,clase:n.id})}),E.selectAll("rect.etiqueta").data(e).enter().append("rect").attr("class",function(t){return"etiqueta "+t.clase}).style("fill",function(t){return t.color}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("stroke",function(t){return t.borde}).attr("stroke-width",2)}function w(){var t=v*T.length,e=window.$(R.node()).width();W.selectAll("rect.presidente").each(function(n,r){var i=T[r],a=i.id,l=window._.select(S,{presidente:a}),o="<p><strong>Sexenio de ";o+=i.nombre,o+=" </strong></p>",o+="<hr>",o+="<h2> ",o+=l.length,o+=1==l.length?" célula delictiva registradas</h2>":" células delictivas registradas</h2>";var c=window._.pluck(l,"cartel");c=window._.uniq(c),o+="<hr>",o+="<ul>",window._.each(c,function(t){var e=window._.select(l,{cartel:t});if(e.length>0){var n=window._.find(O,{id:t});o+='<li style="color:'+n.fondo+'">',o+=e.length,o+=" de ",o+='<strong style="text-transform: uppercase">',o+=n.nombree,o+="</strong>",o+=": ";var r=window._.pluck(e,"nombre");r=r.join(", "),o+=r,o+="</li>"}}),o+="</ul>",$(this).tooltipster({theme:"tooltipster tooltipster-numeroconflictos",offsetX:(v-(j/2+M))/(t/e),offsetY:(m-M)/(t/e),content:$(o),maxWidth:2*v,functionReady:ajustaTooltip,trigger:"click"})})}var h=40,v=6*h,g=50,m=70,A=4,_=200,b=5,k=53,H=35,z=2,q=2,N=0,j=50,M=10,C=40,T=[],O=[],B=[],G=[],F=[],S=[],R=window.d3.select("#contenedor01bh"),V=R.append("svg").attr("id","svg"),Y=V.append("g").attr("transform","translate("+C+",0)"),D=V.append("g").attr("transform","translate("+C+",0)"),E=V.append("g").attr("transform","translate("+C+",0)"),L=V.append("g").attr("transform","translate("+C+",0)"),P=V.append("g"),W=V.append("g").attr("transform","translate("+C+",0)"),X=V.append("g").attr("transform","translate("+C+",0)"),I=V.append("g").attr("transform","translate("+C+",0)"),J=V.append("g");ajustaCarteles=function(){var t=m+A,e=0,n=window._.pluck(O,"fila");n=window._.uniq(n),n.sort(function(t,e){return t-e}),window._.each(n,function(n){var r=0,i=0,a=0,l=window._.select(O,{fila:n}),o=window._.pluck(l,"id");o=window._.uniq(o),window._.each(o,function(e){var n=D.selectAll("rect.cartel."+e);n.each(function(t){t.h>r&&(r=t.h,i=t.yi)});var l=E.selectAll("rect."+e);l.each(function(t){t.height>r&&(r=t.height,i=t.y)}),a=i-t,n.each(function(t){t.y=t.y-a,t.yi=t.yi-a,t.yf=t.yf-a}),L.selectAll("tspan."+e).each(function(){var t=window.d3.select(this);t.attr("y",t.attr("y")-a)}),E.selectAll("rect."+e).each(function(t){t.y=t.y-a})}),n!==e&&(t+=r+A)}),D.selectAll("rect.cartel").attr("y",function(t){return t.yi}),L.selectAll("text.cartel").attr("y",function(t){return t.y+30}),E.selectAll("rect").attr("y",function(t){return t.y});var r=D.selectAll("rect.cartel");r.each(function(t){t.h+t.yi>N&&(N=t.h+t.yi)});var i=E.selectAll("rect");i.each(function(t){t.height+t.y>N&&(N=t.height+t.y)}),N+=A},ajustaTooltip=function(t,e){var n=$(e[0]).find("div").html();$(t).tooltipster("content",$(n))},generaFederaciones=function(){var t=a(),e=(g+A)*O.length,n=[],r=[];Y.selectAll("rect.federacion").data(G).enter().append("rect").attr("class",function(t){return"federacion "+t.id}).attr("x",function(e){var r=(e.inicio-t)*h;return n.push(r),r}).attr("y",m).attr("width",function(t){return t.w=(t.fin-t.inicio)*h,t.w}).attr("height",e).style("fill",function(t){return t.color}),E.selectAll("text.federacion.titulo").data(F).enter().append("text").attr("class","federacion titulo").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",16).style("font-weight","bold").style("text-transform","uppercase").attr("fill",function(t){var e=window._.find(G,{id:t.id});return e.fuente}).attr("x",function(e){var n=window._.find(G,{id:e.id}),r=n.inicio-t,i=n.fin-n.inicio,a=(r+i/2)*h;return e.x=a,a}).attr("y",function(t){return t.y}).text(function(t){var e=window._.find(G,{id:t.id});return e.nombre}),E.selectAll("text.federacion.fechas").data(F).enter().append("text").attr("class","federacion fechas").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",14).attr("fill","#000000").attr("x",function(t){return t.x}).attr("y",function(t){var e=t.y+20;return r.push(t.y+20),e}).text(function(t){var e=window._.find(G,{id:t.id});return e.inicio+" - "+e.fin});var i=window.d3.svg.symbol().type("cross").size(80);Y.append("circle").attr("cx",n[0]+62).attr("cy",r[0]+20).attr("r",12).style("fill","#e1a632"),Y.append("circle").attr("cx",n[0]+84).attr("cy",r[0]+20).attr("r",12).style("fill","#8fc64f"),E.append("path").attr("d",i).attr("transform",function(t){return"translate("+(n[0]+74)+","+(r[0]+20)+")"}),Y.append("circle").attr("cx",n[0]+138).attr("cy",r[0]+20).attr("r",12).style("fill","#54c8f2"),E.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",10).style("font-style","italic").attr("fill","#000000").attr("x",n[0]+112).attr("y",r[0]+25).text("VS."),Y.append("circle").attr("cx",n[1]+14).attr("cy",r[1]+20).attr("r",12).style("fill","#e1a632"),Y.append("circle").attr("cx",n[1]+38).attr("cy",r[1]+20).attr("r",12).style("fill","#8fc64f"),E.append("path").attr("d",i).attr("transform",function(t){return"translate("+(n[1]+26)+","+(r[1]+20)+")"}),Y.append("circle").attr("cx",n[1]+80).attr("cy",r[1]+20).attr("r",12).style("fill","#54c8f2"),Y.append("circle").attr("cx",n[1]+105).attr("cy",r[1]+20).attr("r",12).style("fill","#b09bc7"),E.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",10).style("font-style","italic").attr("fill","#000000").attr("x",n[1]+60).attr("y",r[1]+25).text("VS.")},generaCelulas=function(){I.attr("id","gCelulas"),I.selectAll("circle.total").data(T).enter().append("circle").attr("class","total ignorar").attr("cx",function(t,e){return(e+1)*v-(j+M)+j/2}).attr("cy",function(t){return m/2}).attr("r",j/2).style("fill","#ffffff").style("stroke","#ff0000").attr("stroke-width",2),I.selectAll("text.total").data(T).enter().append("text").attr("class","total ignorar").style("fill","#ff0000").style("stroke","#ff0000").style("text-anchor","middle").style("font-size","36px").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("x",function(t,e){return(e+1)*v-(j+M)+j/2}).attr("y",function(t){return m/2+12}).text(function(t){var e=window._.select(S,{presidente:t.id});return e.length})};var K=null;return generaGrafos=function(){I.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").style("fill","#ffffff").style("opacity",0).attr("class","pointer").attr("transform","translate(0,"+m+")").on("click",resaltaTodos),window._.each(T,function(t){var e=window._.select(O,function(e){return e.inicio>=t.inicio&&e.fin<=t.inicio+6?!0:!1}),n=window._.indexBy(e,"id");window._.each(n,function(e){var n=window._.select(S,{presidente:t.id,cartel:e.id});if(n.length>0){var r=e.id+" "+t.id,i=I.append("g").attr("transform","translate("+e.x+","+e.yi+")"),a=[{nombre:e.inicialc,x:e.w/2,y:e.h/2,fixed:!0,cartel:e.id,presidente:t.id,clase:r,xi:e.w/2,yi:e.h/2}],l=[],o=0;window._.each(n,function(t){o++,a.push({nombre:t.nombre,clase:r}),l.push({source:0,target:o,clase:r})});var c=window.d3.layout.force().nodes(a).links(l).size([e.w,e.h]).linkDistance(10).charge([-1500]).gravity(.3),s=i.selectAll(".link").data(l).enter().append("line").style("stroke","#ffffff").style("z-index",0).attr("class",function(t){return"link ignorar "+t.clase}).style("opacity",.2),f=i.selectAll(".node").data(a).enter().append("circle").attr("fill",function(t,n){var r=e.fondo;return 0===n&&(r=e.fondo),r}).attr("class",function(t,e){var n="node "+t.clase;return n+=0===e?" fixed pointer":" grab"}).attr("r",function(t,e){var n=10;return 0===e&&(n=16),n}).style("z-index",function(t,e){var n=0;return 0===e&&(n=100),n}).style("opacity",function(t,e){var n=.2;return 0===e&&(n=1),n}).on("click",function(t,e){if(0===e){var n=t.cartel+"-"+t.presidente;K===n?(K=null,resaltaTodos()):(K=n,resaltaGrafos(t.cartel,t.presidente))}}).on("mouseover",function(t,e){0===e&&null===K&&resaltaGrafos(t.cartel,t.presidente)}).on("mouseout",function(t,e){0===e&&null===K&&resaltaTodos()}).call(c.drag),d=i.selectAll("text").data(a).enter().append("text").style("fill","#ffffff").style("stroke","#ffffff").style("text-anchor","middle").style("font-size",function(t,e){var n="14px";return 0===e&&(n="18px"),n}).attr("class",function(t){return"node ignorar "+t.clase}).style("z-index",function(t,e){var n=0;return 0===e&&(n=100),n}).style("opacity",function(t,e){var n=.2;return 0===e&&(n=1),n}).style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').text(function(t){return t.nombre});c.on("tick",function(){f.attr("cx",function(t){return 0===t.index&&(t.x=t.xi),t.x}).attr("cy",function(t){return 0===t.index&&(t.y=t.yi),t.y}),s.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),d.attr("transform",function(t){return"translate("+t.x+","+(t.y+6)+")"})}),c.start()}})})},resaltaTodos=function(){K=null,I.selectAll("circle.node").style("opacity",function(t){var e=.2;return 0===t.index&&(e=1),e}),I.selectAll("text.node").style("opacity",function(t){var e=.2;return 0===t.index&&(e=1),e}),I.selectAll(".link").style("opacity",.2)},resaltaGrafos=function(t,e){I.selectAll("circle.node").style("opacity",function(n){var r=n.clase.split(" "),i=r.indexOf(t)>=0?!0:!1,a=r.indexOf(e)>=0?!0:!1,l=0;return i&&a?l=1:0===n.index&&(l=.5),l}),I.selectAll("text.node").style("opacity",function(n){var r=n.clase.split(" "),i=r.indexOf(t)>=0?!0:!1,a=r.indexOf(e)>=0?!0:!1,l=0;return i&&a?l=1:0===n.index&&(l=.5),l}),I.selectAll(".link").style("opacity",function(n){var r=n.clase.split(" "),i=r.indexOf(t)>=0?!0:!1,a=r.indexOf(e)>=0?!0:!1,l=0;return i&&a?l=1:0===n.index&&(l=.5),l})},{init:t}}();