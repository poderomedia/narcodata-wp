var visualizacion_v=function(){function t(){var t=queue(1);t.defer(window.d3.tsv,"tsv/presidentes.tsv",function(t){return{id:t.id,nombre:t.nombre,inicio:+t.inicio,fotografia:"img/"+t.fotografia,nombrecorto:t.nombrecorto}}),t.defer(window.d3.tsv,"tsv/carteles.tsv",function(t){return{id:t.id,nombre:t.nombre,nombree:t.nombree,nombrelargo:t.nombrelargo,fila:+t.fila,mitad:"1"===t.mitad?!0:!1,fondo:t.fondo,color:t.color,borde:t.borde,anillo:t.anillo,inicio:+t.inicio,fin:+t.fin,porcentaje:+t.porcentaje,pleca:"1"===t.pleca?!0:!1,lineaini:t.lineaini,lineafin:t.lineafin,inicial:t.inicial,inicialc:t.inicialc,lideres:t.lideres.split("|"),x:0,y:0,w:0,h:0,yi:0,yf:0}}),t.defer(window.d3.tsv,"tsv/origenes.tsv",function(t){return{origen:t.origen,destino:t.destino,offset:+t.offset}}),t.defer(window.d3.tsv,"tsv/federaciones.tsv",function(t){return{id:t.id,nombre:t.nombre,lideres:t.lideres.split("|"),inicio:+t.inicio,fin:+t.fin,color:t.color,fuente:t.fuente,w:0,y:0,x:0}}),t.defer(window.d3.tsv,"tsv/federacionescarteles.tsv",function(t){return{id:t.id,aliados:t.aliados.split("|"),involucrados:t.involucrados.split("|"),x:0,y:500}}),t.defer(window.d3.tsv,"tsv/celulas.tsv"),t.awaitAll(e)}function e(t,e){M=e[0],j=e[1],O=e[2],T=e[3],B=e[4],F=e[5];var r=window._.indexBy(j,"fila"),a=window._.pluck(r,"fila"),l=(h+g)*a.length+v,c=w*M.length;I.append("rect").attr("fill","#cdcdcd").attr("y",0).attr("x",0).attr("height",z).attr("width",v),I.append("rect").attr("fill","#58595b").attr("y",0).attr("x",v).attr("height",z).attr("width",l);Y.append("rect").attr("class","telon").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").style("fill","#000000").style("opacity",.7);n(),generaFederaciones(),i(),o(),s(),y(),ajustaCarteles(),d(),p(),C.attr("viewBox","0 0 "+b+" "+(c+z)),I.append("text").attr("y",z/2+6).attr("x",b/2).style("stroke","#ffffff").style("fill","#ffffff").style("text-transform","uppercase").style("font-size",18).style("font-family",'"Helvetica Neue",Helvetica,Arial,sans-serif').style("letter-spacing",5).html("Cárteles")}function n(){D.selectAll("rect.presidente").data(M).enter().append("rect").attr("y",function(t,e){return e*w}).attr("x",0).attr("class","presidente").attr("height",w).attr("width",v).attr("fill","#000000").style("stroke","#ffffff").style("stroke-width",2),D.selectAll("text.periodo.inicio").data(M).enter().append("text").attr("class","periodo inicio ignorar").attr("y",function(t,e){return r(e)}).attr("x",A).style("font-size","24px").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text(function(t){return t.inicio}),D.selectAll("text.periodo.inter").data(M).enter().append("text").attr("class","periodo inter ignorar").attr("y",function(t,e){return r(e)+23}).attr("x",A).style("font-size","24px").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text("a"),D.selectAll("text.periodo.fin").data(M).enter().append("text").attr("class","periodo fin ignorar").attr("y",function(t,e){return r(e)+50}).attr("x",A).style("font-size","24px").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("fill","#ffffff").attr("text-anchor","middle").text(function(t){var e=t.inicio+6;return"EPN"==t.id&&(e=2014),e}),D.selectAll(".fotografia.presidente").data(M).enter().append("svg:image").attr("width",k).attr("height",k).attr("class","presidente fotografia ignorar").attr("xlink:href",function(t){return t.fotografia}).attr("y",function(t,e){return e*w+ +H}).attr("x",function(){return(v-k)/2})}function r(t){return t*w+2*H+k+23}function i(){var t=M.length+1,e=0,n=(h+g)*j.length,r=1;for(r=1;t>=r;r++)P.append("line").style("stroke","#000000").style("stroke-width",1).style("opacity",1).attr("y1",e).attr("x1",v).attr("y2",e).attr("x2",v+n).style("stroke-dasharray","1,3"),e=r*w}function a(){var t=window._.min(M,function(t){return t.inicio});return t.inicio}function l(t){return Math.ceil(h*t/100)}function c(t){return Math.ceil((h-t)/2)}function o(){var t=a(),e=0,n=0,r=0,i=0,o=0,s=0,f=0,d=0;window._.each(j,function(a){e=v+(h+g)*a.fila-h,a.mitad&&(e+=h/2),r=l(a.porcentaje),f=e+c(r),s=f+r,i=(a.inicio-t)*x,o=(a.fin-t)*x,n=i,d=o-i,a.x=e,a.y=n,a.w=r,a.h=d,a.xf=s,a.xi=f}),V.selectAll("rect.cartel").data(j).enter().append("rect").attr("class",function(t){return"cartel "+t.id}).attr("x",function(t){return t.xi}).attr("y",function(t){return t.y}).attr("width",function(t){return t.w}).attr("height",function(t){return t.h}).attr("fill",function(t){return t.fondo}).attr("stroke",function(t){return t.fondo}).attr("stroke-width",1)}function s(){var t=(2*u(m),window._.select(j,function(t){return""!==t.inicial}));R.selectAll("text.cartel").data(t).enter().append("text").attr("class","cartel").attr("class",function(t){return"cartel "+t.id}).attr("fill","#ffffff").style("font-weight","bold").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",12).attr("text-anchor","middle").attr("y",function(t){return t.y+Math.ceil(t.h/2)+N}).attr("x",function(t){return t.xi+Math.ceil(t.w/2)}).text(function(t){return t.inicial})}function f(t){var e=window._.select(j,function(e){return""!==e[t]}),n=window._.pluck(e,t);return n=window._.uniq(n)}function d(){var t=f("lineaini"),e=[],n=0,r=0,i=0,a={},l=[];window._.each(t,function(t){e=window._.select(j,{lineaini:t}),a=window._.min(e,"y"),n=a.y,a=window._.min(e,"xi"),r=a.xi,a=window._.max(e,"xf"),i=a.xf,l.push({y1:n,y2:n,x1:r,x2:i})}),t=f("lineafin"),window._.each(t,function(t){e=window._.select(j,{lineafin:t}),a=window._.min(e,"y"),n=a.y+a.h,a=window._.min(e,"xi"),r=a.xi,a=window._.max(e,"xf"),i=a.xf,l.push({y1:n,y2:n,x1:r,x2:i})}),R.selectAll("line.pleca").data(l).enter().append("line").attr("class","pleca").style("stroke","#000000").style("stroke-width",_).style("opacity",1).attr("y1",function(t){return t.y1}).attr("x1",function(t){return t.x1}).attr("y2",function(t){return t.y2}).attr("x2",function(t){return t.x2});var c=window.d3.svg.symbol().type("triangle-up").size(m),o=u(m),s=h/2,d=window._.select(j,{pleca:!0});R.selectAll("path.pleca").data(d).enter().append("path").attr("d",c).attr("class","pleca").attr("transform",function(t){return"translate("+(t.x+s)+","+(t.y+o)+"), rotate(180)"});var y=[],p=[],x=o,w=null,v=null,g=[];window._.each(O,function(t){g=window._.select(j,{id:t.destino}),v=window._.min(g,"inicio"),w=window._.find(j,function(e){return e.id===t.origen&&e.inicio<=v.inicio&&v.inicio<=e.fin}),y.push({y1:v.y-10,y2:v.y+_/2,x1:w.xi+w.w/2+t.offset,x2:w.xi+w.w/2+t.offset}),v.xi>=w.xi?(y.push({y1:v.y,y2:v.y,x1:w.xi+w.w/2+t.offset,x2:v.xi-x}),p.push({y:v.y,x:v.xi,o:-x,rot:90})):(y.push({y1:v.y,y2:v.y,x1:w.xi+w.w/2+t.offset,x2:v.xf+x}),p.push({y:v.y,x:v.xf,o:x,rot:-90}))}),R.selectAll("line.flecha").data(y).enter().append("line").attr("class","flecha").style("stroke","#000000").style("stroke-width",_).style("opacity",1).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2}),R.selectAll("path.flecha").data(p).enter().append("path").attr("d",c).attr("class","flecha").attr("transform",function(t){return"translate("+(t.x+t.o)+","+t.y+"), rotate("+t.rot+")"})}function u(t){var e=Math.sqrt(3)/2,n=Math.sqrt(e*t*2);return Math.floor(n/2)-2}function y(){var t=[],t=window._.select(j,function(t){return""!==t.inicial});E.selectAll("circle.etiqueta").data(t).enter().append("circle").attr("class",function(t){return"etiqueta "+t.id}).style("fill",function(t){return t.color}).style("stroke",function(t){return t.borde}).attr("stroke-width",2).attr("cx",function(t){return t.cx=t.xi+t.w/2,t.cx}).attr("cy",function(t){return t.cy=t.y+t.h/2-N,t.cy}).attr("r",q)}function p(){var t=w*M.length,e=window.$(S.node()).height();D.selectAll("rect.presidente").each(function(n,r){var i=M[r],a=i.id,l=window._.select(F,{presidente:a}),c="<p><strong>Sexenio de ";c+=i.nombre,c+=" </strong></p>",c+="<hr>",c+="<h2> ",c+=l.length,c+=1==l.length?" célula delictiva registradas</h2>":" células delictivas registradas</h2>";var o=window._.pluck(l,"cartel");o=window._.uniq(o),c+="<hr>",c+='<ul style="line-height:13px;">',window._.each(o,function(t){var e=window._.select(l,{cartel:t});if(e.length>0){var n=window._.find(j,{id:t});c+='<li style="color:'+n.fondo+'">',c+=e.length,c+=" de ",c+='<strong style="text-transform: uppercase">',c+=n.nombree,c+="</strong>",c+=": ";var r=window._.pluck(e,"nombre");r=r.join(", "),c+=r,c+="</li>"}}),c+="</ul>",$(this).tooltipster({theme:"tooltipsterv tooltipster-numeroconflictos",offsetX:v/2/(t/e),offsetY:w/(t/e),content:$(c),functionReady:ajustaTooltip,trigger:"click"})})}var x=26,w=6*x,h=50,v=70,g=4,m=200,_=5,A=35,b=0,k=50,H=10,z=40,q=18,N=2,M=[],j=[],O=[],T=[],B=[],F=[],S=window.d3.select("#contenedor01bv"),C=S.append("svg").attr("preserveAspectRatio","xMidYMid").attr("id","svg"),G=C.append("g").attr("transform","translate(0,"+z+")"),V=C.append("g").attr("transform","translate(0,"+z+")"),E=C.append("g").attr("transform","translate(0,"+z+")"),R=C.append("g").attr("transform","translate(0,"+z+")"),Y=C.append("g"),D=C.append("g").attr("transform","translate(0,"+z+")"),P=C.append("g").attr("transform","translate(0,"+z+")"),X=C.append("g").attr("transform","translate(0,"+z+")"),I=C.append("g");ajustaCarteles=function(){var t=v+g,e=0,n=window._.pluck(j,"fila");n=window._.uniq(n),n.sort(function(t,e){return t-e}),window._.each(n,function(n){var r=0,i=0,a=0,l=window._.select(j,{fila:n}),c=window._.pluck(l,"id");c=window._.uniq(c),window._.each(c,function(e){var n=V.selectAll("rect.cartel."+e);n.each(function(t){t.w>r&&(r=t.w,i=t.xi)});var l=E.selectAll("circle."+e);l.each(function(){var t=this.getBBox();t.width>r&&(r=t.width,i=t.x)}),a=i-t,n.each(function(t){t.x=t.x-a,t.xi=t.xi-a,t.xf=t.xf-a}),E.selectAll("circle."+e).each(function(t){t.cx=t.cx-a})}),n!==e&&(t+=r+g)}),V.selectAll("rect.cartel").attr("x",function(t){return t.xi}),R.selectAll("text.cartel").attr("x",function(t){return t.xi+t.w/2}),E.selectAll("circle").attr("cx",function(t){return t.cx});var r=V.selectAll("rect.cartel");r.each(function(t){t.w+t.xi>b&&(b=t.w+t.xi)});var i=E.selectAll("circle");i.each(function(t){2*q+t.x>b&&(b=2*q+t.x)}),b+=g},ajustaTooltip=function(t,e){var n=$(e[0]).find("div").html();$(t).tooltipster("content",$(n))},generaFederaciones=function(){var t=a(),e=(h+g)*j.length;G.selectAll("rect.federacion").data(T).enter().append("rect").attr("class",function(t){return"federacion "+t.id}).attr("y",function(e){return(e.inicio-t)*x}).attr("x",v).attr("height",function(t){return t.h=(t.fin-t.inicio)*x,t.h}).attr("width",e).style("fill",function(t){return t.color}),E.selectAll("text.federacion.titulo").data(B).enter().append("text").attr("class","federacion titulo").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",18).style("font-weight","bold").style("text-transform","uppercase").attr("fill",function(t){var e=window._.find(T,{id:t.id});return e.fuente}).attr("y",function(e){var n=window._.find(T,{id:e.id}),r=(n.inicio-t)*x;return e.y+=r,"federacion-2"===n.id&&(e.y+=20),e.y="federacion-1"===n.id?472:680,e.y}).attr("x",function(t){return t.x=560,t.x}).text(function(t){var e=window._.find(T,{id:t.id});return e.nombre});var n=[578,604],r=[490,693];G.attr("id","gFederaciones"),E.attr("id","gEtiquetas");var i=window.d3.svg.symbol().type("cross").size(36);G.append("circle").attr("cx",n[0]+32).attr("cy",r[0]).attr("r",6).style("fill","#e1a632"),G.append("circle").attr("cx",n[0]+44).attr("cy",r[0]).attr("r",6).style("fill","#8fc64f"),E.append("path").attr("d",i).attr("transform",function(){return"translate("+(n[0]+38)+","+r[0]+")"}),G.append("circle").attr("cx",n[0]+44).attr("cy",r[0]+22).attr("r",6).style("fill","#54c8f2"),E.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",5).style("font-style","italic").attr("fill","#000000").attr("x",n[0]+46).attr("y",r[0]+13).text("VS."),G.append("circle").attr("cx",n[1]+6).attr("cy",r[1]).attr("r",6).style("fill","#e1a632"),G.append("circle").attr("cx",n[1]+18).attr("cy",r[1]).attr("r",6).style("fill","#8fc64f"),E.append("path").attr("d",i).attr("transform",function(){return"translate("+(n[1]+12)+","+r[1]+")"}),G.append("circle").attr("cx",n[1]+4).attr("cy",r[1]+22).attr("r",6).style("fill","#54c8f2"),G.append("circle").attr("cx",n[1]+18).attr("cy",r[1]+22).attr("r",6).style("fill","#b09bc7"),E.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",5).style("font-style","italic").attr("fill","#000000").attr("x",n[1]+20).attr("y",r[1]+13).text("VS.")},generaFederaciones00=function(){var t=a(),e=(h+g)*j.length;G.selectAll("rect.federacion").data(T).enter().append("rect").attr("class",function(t){return"federacion "+t.id}).attr("y",function(e){return(e.inicio-t)*x}).attr("x",v).attr("height",function(t){return t.h=(t.fin-t.inicio)*x,t.h}).attr("width",e).style("fill",function(t){return t.color}),E.selectAll("text.federacion.titulo").data(B).enter().append("text").attr("class","federacion titulo").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",18).style("font-weight","bold").style("text-transform","uppercase").attr("fill",function(t){var e=window._.find(T,{id:t.id});return e.fuente}).attr("y",function(e){var n=window._.find(T,{id:e.id}),r=(n.inicio-t)*x;return e.y+=r,"federacion-2"===n.id&&(e.y+=20),e.y}).attr("x",function(t){return t.x}).text(function(t){var e=window._.find(T,{id:t.id});return e.nombre});var n=[578,604],r=[490,693];G.attr("id","gFederaciones"),E.attr("id","gEtiquetas");var i=window.d3.svg.symbol().type("cross").size(36);G.append("circle").attr("cx",n[0]+32).attr("cy",r[0]).attr("r",6).style("fill","#e1a632"),G.append("circle").attr("cx",n[0]+44).attr("cy",r[0]).attr("r",6).style("fill","#8fc64f"),E.append("path").attr("d",i).attr("transform",function(){return"translate("+(n[0]+38)+","+r[0]+")"}),G.append("circle").attr("cx",n[0]+44).attr("cy",r[0]+22).attr("r",6).style("fill","#54c8f2"),E.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",5).style("font-style","italic").attr("fill","#000000").attr("x",n[0]+46).attr("y",r[0]+13).text("VS."),G.append("circle").attr("cx",n[1]+6).attr("cy",r[1]).attr("r",6).style("fill","#e1a632"),G.append("circle").attr("cx",n[1]+18).attr("cy",r[1]).attr("r",6).style("fill","#8fc64f"),E.append("path").attr("d",i).attr("transform",function(){return"translate("+(n[1]+12)+","+r[1]+")"}),G.append("circle").attr("cx",n[1]+4).attr("cy",r[1]+22).attr("r",6).style("fill","#54c8f2"),G.append("circle").attr("cx",n[1]+18).attr("cy",r[1]+22).attr("r",6).style("fill","#b09bc7"),E.append("text").attr("class","federacion etiqueta").attr("text-anchor","middle").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size",5).style("font-style","italic").attr("fill","#000000").attr("x",n[1]+20).attr("y",r[1]+13).text("VS.")},generaCelulas=function(){X.selectAll("circle.total").data(M).enter().append("circle").attr("class","total ignorar").attr("cy",function(t,e){return e*w+ +H+k/2}).attr("cx",function(){return v/2}).attr("r",k/2).style("fill","#ffffff").style("stroke","#ff0000").attr("stroke-width",2),X.selectAll("text.total").data(M).enter().append("text").attr("class","total ignorar").style("fill","#ff0000").style("stroke","#ff0000").style("text-anchor","middle").style("font-size","36px").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').attr("y",function(t,e){return e*w+ +H+k/2+12}).attr("x",function(){return v/2}).text(function(t){var e=window._.select(F,{presidente:t.id});return e.length})};var J=null;return generaGrafos=function(){X.append("rect").attr("y",0).attr("x",0).attr("height","100%").attr("width","100%").style("fill","#ffffff").style("opacity",0).attr("class","pointer").attr("transform","translate(0,"+v+")").on("click",resaltaTodos),window._.each(M,function(t){var e=window._.select(j,function(e){return e.inicio>=t.inicio&&e.fin<=t.inicio+6?!0:!1}),n=window._.indexBy(e,"id");window._.each(n,function(e){var n=window._.select(F,{presidente:t.id,cartel:e.id});if(n.length>0){var r=e.id+" "+t.id,i=X.append("g").attr("transform","translate("+e.xi+","+(e.y-2)+")"),a=[{nombre:e.inicialc,x:e.w/2,y:e.h/2,fixed:!0,cartel:e.id,presidente:t.id,clase:r,xi:e.w/2,yi:e.h/2}],l=[],c=0;window._.each(n,function(t){c++,a.push({nombre:t.nombre,clase:r}),l.push({source:0,target:c,clase:r})});var o=window.d3.layout.force().nodes(a).links(l).size([e.w,e.h]).linkDistance(100).charge(-10).gravity(.2),s=i.selectAll(".link").data(l).enter().append("line").style("stroke","#ffffff").style("z-index",0).attr("class",function(t){return"link ignorar "+t.clase}).style("opacity",.2),f=i.selectAll(".node").data(a).enter().append("circle").attr("fill",function(t,n){var r=e.fondo;return 0===n&&(r=e.fondo),r}).attr("class",function(t,e){var n="node "+t.clase;return n+=0===e?" fixed pointer":" grab"}).attr("r",function(t,e){var n=10;return 0===e&&(n=19),n}).style("z-index",function(t,e){var n=0;return 0===e&&(n=100),n}).style("opacity",function(t,e){var n=.2;return 0===e&&(n=1),n}).on("click",function(t,e){if(0===e){var n=t.cartel+"-"+t.presidente;J===n?(J=null,resaltaTodos()):(J=n,resaltaGrafos(t.cartel,t.presidente))}}).on("mouseover",function(t,e){0===e&&null===J&&resaltaGrafos(t.cartel,t.presidente)}).on("mouseout",function(t,e){0===e&&null===J&&resaltaTodos()}).call(o.drag),d=i.selectAll("text").data(a).enter().append("text").style("fill","#ffffff").style("stroke","#ffffff").style("text-anchor","middle").style("font-size",function(t,e){var n="14px";return 0===e&&(n="18px"),n}).attr("class",function(t){return"node ignorar "+t.clase}).style("z-index",function(t,e){var n=0;return 0===e&&(n=100),n}).style("opacity",function(t,e){var n=.2;return 0===e&&(n=1),n}).style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').text(function(t){return t.nombre});o.on("tick",function(){f.attr("cx",function(t){return 0===t.index&&(t.x=t.xi),t.x}).attr("cy",function(t){return 0===t.index&&(t.y=t.yi),t.y}),s.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),d.attr("transform",function(t){return"translate("+t.x+","+(t.y+6)+")"})}),o.start()}})})},resaltaTodos=function(){J=null,X.selectAll("circle.node").style("opacity",function(t){var e=.2;return 0===t.index&&(e=1),e}),X.selectAll("text.node").style("opacity",function(t){var e=.2;return 0===t.index&&(e=1),e}),X.selectAll(".link").style("opacity",.2)},resaltaGrafos=function(t,e){X.selectAll("circle.node").style("opacity",function(n){var r=n.clase.split(" "),i=r.indexOf(t)>=0?!0:!1,a=r.indexOf(e)>=0?!0:!1,l=0;return i&&a?l=1:0===n.index&&(l=.5),l}),X.selectAll("text.node").style("opacity",function(n){var r=n.clase.split(" "),i=r.indexOf(t)>=0?!0:!1,a=r.indexOf(e)>=0?!0:!1,l=0;return i&&a?l=1:0===n.index&&(l=.5),l}),X.selectAll(".link").style("opacity",function(n){var r=n.clase.split(" "),i=r.indexOf(t)>=0?!0:!1,a=r.indexOf(e)>=0?!0:!1,l=0;return i&&a?l=1:0===n.index&&(l=.5),l})},{init:t}}();